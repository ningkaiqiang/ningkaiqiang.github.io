---
layout: post
title: "JSBridge的实现与项目中的封装思路（二）"
subtitle: "iOS JSBridge"
date: 2021-11-03
author: "NKQ"
header-img: "img/home-bg-art.jpg"
tags:
 - iOS
 - Web
 - JSBridge
---

> 上一篇讲到来自JS的请求是如何调用原生代码的，这一篇来看原生的代码是如何调用JS的，以及请求究竟是如何发送的

## 原生代码调用JS

在flushMessageQueue这个方法中，进行了responseId的判断，这个responseId存储在OC代码调用JS时由JSBridge维护的字典中，在OC的请求发出后，看一下JS代码的实现

打开WebViewJavascriptBridge_js这个文件，把里面的JS代码复制一下，用VSCode看，Xcode的高亮属实拉胯，可以看到有一个_dispatchMessageFromObjC放啊，看名字就知道是处理OC调用的，它调用了_doDispatchMessageFromObjC方法，在这个方法里面快速浏览一下，发现此方法的实现与OC中的 flushMessageQueue 方法是高度对应的，看来OC调用JS也是用几乎一样的方式。

- 判断responseId
- 判断callbackID
- 调用handler

